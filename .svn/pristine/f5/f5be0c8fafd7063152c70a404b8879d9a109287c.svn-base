(function () {
    document.addEventListener('DOMContentLoaded', () => {
        setupSidebar();
    });

    function setupSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const header = document.querySelector('.header');
        const toggleCheckbox = document.getElementById('toggleSidebarFixed');

        if (!sidebar || !mainContent || !header || !toggleCheckbox) {
            console.error('Không tìm thấy một trong các phần tử: sidebar, mainContent, header, toggleCheckbox');
            return;
        }

        // Khởi tạo trạng thái từ localStorage
        const isSidebarFixed = localStorage.getItem('isSidebarFixed') === 'true';
        toggleCheckbox.checked = isSidebarFixed;
        setSidebarState(isSidebarFixed);

        // Checkbox thay đổi
        toggleCheckbox.addEventListener('change', (event) => {
            const isChecked = event.target.checked;
            localStorage.setItem('isSidebarFixed', isChecked);
            setSidebarState(isChecked);
        });

        // Hover effect khi không cố định
        sidebar.addEventListener('mouseenter', () => {
            if (!toggleCheckbox.checked) {
                sidebar.classList.add('sidebar-hover'); // Chỉ mở rộng sidebar
                document.querySelectorAll('#sidebar .nav-link span, #sidebar .dashboard-container span').forEach(span => {
                    span.style.opacity = '1';
                });
            }
        });

        sidebar.addEventListener('mouseleave', () => {
            if (!toggleCheckbox.checked) {
                sidebar.classList.remove('sidebar-hover');
                document.querySelectorAll('#sidebar .nav-link span, #sidebar .dashboard-container span').forEach(span => {
                    span.style.opacity = '0';
                });
            }
        });

        function setSidebarState(isFixed) {
            if (isFixed) {
                sidebar.classList.remove('sidebar-hover'); // Xóa trạng thái hover nếu có
                sidebar.classList.add('open');
                document.documentElement.classList.add('sidebar-expanded');
                sidebar.style.width = '260px';
                mainContent.style.marginLeft = '260px';
                header.style.left = '260px';
                header.style.width = 'calc(100% - 260px)';
                document.querySelectorAll('#sidebar .nav-link span, #sidebar .dashboard-container span').forEach(span => {
                    span.style.opacity = '1';
                });
            } else {
                sidebar.classList.remove('open');
                document.documentElement.classList.remove('sidebar-expanded');
                sidebar.style.width = '70px';
                mainContent.style.marginLeft = '70px';
                header.style.left = '70px';
                header.style.width = 'calc(100% - 70px)';
                document.querySelectorAll('#sidebar .nav-link span, #sidebar .dashboard-container span').forEach(span => {
                    span.style.opacity = '0';
                });
            }
            // Đảm bảo transition hoạt động sau khi thay đổi trạng thái
            sidebar.style.transition = 'width 0.25s ease';
            mainContent.style.transition = 'margin-left 0.25s ease';
            header.style.transition = 'left 0.25s ease, width 0.25s ease';
            document.querySelectorAll('#sidebar .nav-link span, #sidebar .dashboard-container span').forEach(span => {
                span.style.transition = 'opacity 0.25s ease';
            });
        }
    }

    // Hàm toggle search (giữ nguyên)
    window.toggleSearch = function () {
        const searchContainer = document.getElementById('searchContainer');
        searchContainer.classList.toggle('expanded');
    };
})();

// Sử dụng SweetAlert2 cho thông báo
function showError(message) {
    Swal.fire({
        icon: 'error',
        title: 'Lỗi',
        text: message,
        confirmButtonText: 'OK',
        confirmButtonColor: '#3085d6',
    });
}

//function showSuccess(message) {
//    Swal.fire({
//        icon: 'success',
//        title: 'Thành công',
//        text: message,
//        confirmButtonText: 'OK',
//        confirmButtonColor: '#3085d6',
//    });
//}

function showSuccess(message) {
    Swal.fire({
        title: message,
        icon: "success",
        draggable: true
    });
}
function showWarning(message) {
    Swal.fire({
        title: message,
        icon: "warning",
        draggable: true
    });
}
function showInfo(message) {
    Swal.fire({
        title: message,
        icon: "info",
        draggable: true
    });
}


particlesJS("particles-js", {
    particles: {
        number: { value: 100, density: { enable: true, value_area: 800 } },
        color: { value: "#76b900" },
        shape: { type: "circle" },
        opacity: { value: 0.5, random: true, anim: { enable: true, speed: 1, opacity_min: 0.1, sync: false } },
        size: { value: 3, random: true, anim: { enable: false } },
        line_linked: { enable: true, distance: 150, color: "#76b900", opacity: 0.4, width: 1 },
        move: { enable: true, speed: 2, direction: "none", random: false, straight: false, out_mode: "out", bounce: false }
    },
    interactivity: {
        detect_on: "canvas",
        events: { onhover: { enable: true, mode: "repulse" }, onclick: { enable: true, mode: "push" } },
        modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
    },
    retina_detect: true
});