@{
    ViewData["Title"] = "Replace BGA control";
    Layout = "~/Areas/BGA/Views/Shared/layout_bga.cshtml";
}

<section id="process" class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold text-primary mb-1">Replace BGA process</h2>
            <p class="text-muted mb-0">Tổng quan tài liệu và các bước thực hiện Replace BGA.</p>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Tài liệu quy trình</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">File PDF mô tả chi tiết luồng Replace BGA sẽ được cập nhật và hiển thị tại đây.</p>
                    <div class="border rounded p-4 text-center text-muted">
                        <i class="fas fa-file-pdf fa-2x mb-3 text-secondary"></i>
                        <p class="mb-0">Vui lòng tải lên tài liệu để hiển thị.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Bảng trạng thái Replace BGA</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Stt</th>
                                    <th scope="col">Item</th>
                                    <th scope="col">ApplyScrapStatus</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>1</td><td>Waiting approve replace BGA</td><td>4</td></tr>
                                <tr><td>2</td><td>Check in barking</td><td>10</td></tr>
                                <tr><td>3</td><td>Check out barking</td><td>11</td></tr>
                                <tr><td>4</td><td>VI after barking</td><td>12</td></tr>
                                <tr><td>5</td><td>Remove BGA, clean pad</td><td>13</td></tr>
                                <tr><td>6</td><td>Check VI BGA pad</td><td>14</td></tr>
                                <tr><td>7</td><td>Replace BGA</td><td>15</td></tr>
                                <tr><td>8</td><td>Xray</td><td>16</td></tr>
                                <tr><td>9</td><td>ICT, FT</td><td>17</td></tr>
                                <tr><td>10</td><td>Replaced BGA ok</td><td>3</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-muted mt-3 mb-0">Ở bước Xray (trạng thái 16), nếu kết quả OK hệ thống sẽ chuyển sang trạng thái 17, nếu NG sẽ quay lại trạng thái 13.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="dashboard" class="container-fluid pb-4">
    <div class="row mb-4">
        <div class="col-12 d-flex flex-wrap align-items-center justify-content-between gap-2">
            <div>
                <h2 class="fw-bold text-primary mb-1">Dashboard Replace BGA</h2>
                <p class="text-muted mb-0">Theo dõi trạng thái hiện tại và thời gian Barking.</p>
            </div>
            <div class="d-flex align-items-center gap-3">
                <small class="text-muted">Cập nhật lần cuối: <span id="dashboard-last-updated">Chưa tải</span></small>
                <button id="refresh-dashboard-btn" class="btn btn-outline-primary btn-sm"><i class="fas fa-sync-alt me-1"></i>Refresh</button>
            </div>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="mb-0">Số lượng theo ApplyScrapStatus</h5>
                </div>
                <div class="card-body">
                    <div id="status-chart-empty" class="alert alert-info d-none" role="alert"></div>
                    <canvas id="status-chart" height="220" class="d-none"></canvas>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="mb-0">Thời gian Barking (ApplyScrapStatus = 11)</h5>
                </div>
                <div class="card-body">
                    <div id="barking-age-empty" class="alert alert-info d-none" role="alert"></div>
                    <canvas id="barking-age-chart" height="220" class="d-none"></canvas>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="actions" class="container-fluid pb-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold text-primary mb-1">Thao tác xác nhận trạng thái</h2>
            <p class="text-muted mb-0">Cập nhật trạng thái và remark cho các SN đã chọn.</p>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-12 col-lg-8">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="mb-0">Cập nhật trạng thái</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="current-status" class="form-label fw-semibold">Trạng thái hiện tại</label>
                        <select id="current-status" class="form-select">
                            <option value="4">4 - Waiting approve replace BGA</option>
                            <option value="10">10 - Check in barking</option>
                            <option value="11">11 - Check out barking</option>
                            <option value="12">12 - VI after barking</option>
                            <option value="13">13 - Remove BGA, clean pad</option>
                            <option value="14">14 - Check VI BGA pad</option>
                            <option value="15">15 - Replace BGA</option>
                            <option value="16">16 - Xray</option>
                            <option value="17">17 - ICT, FT</option>
                        </select>
                    </div>

                    <div id="xray-result-group" class="mb-3 d-none">
                        <label class="form-label fw-semibold d-block">Kết quả Xray</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="xray-result" id="xray-ok" value="OK">
                            <label class="form-check-label" for="xray-ok">OK</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="xray-result" id="xray-ng" value="NG">
                            <label class="form-check-label" for="xray-ng">NG</label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="sn-input" class="form-label fw-semibold">Danh sách SN</label>
                        <textarea id="sn-input" class="form-control" rows="6" placeholder="Nhập mỗi SN trên một dòng hoặc tách bằng dấu phẩy"></textarea>
                        <div class="form-text">Chỉ cập nhật được các SN đang ở trạng thái đã chọn.</div>
                    </div>

                    <div class="mb-3">
                        <label for="remark-input" class="form-label fw-semibold">Remark</label>
                        <input id="remark-input" type="text" class="form-control" maxlength="50" placeholder="Nhập remark (tối đa 50 ký tự)">
                    </div>

                    <div class="d-grid gap-2">
                        <button id="update-status-btn" class="btn btn-primary">Xác nhận trạng thái</button>
                        <div id="update-status-feedback" class="alert mt-3 d-none" role="alert"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Ghi chú nhanh</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2"><i class="fas fa-circle text-primary me-2"></i>Remark được lưu vào <strong>FindBoardStatus</strong>.</li>
                        <li class="mb-2"><i class="fas fa-circle text-primary me-2"></i>Sau khi cập nhật, hệ thống tự động ghi lịch sử vào <strong>HistoryScrapList</strong>.</li>
                        <li class="mb-0"><i class="fas fa-circle text-primary me-2"></i>Ở bước Xray, chọn OK để chuyển sang trạng thái 17 hoặc NG để quay về 13.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="search" class="container-fluid pb-5">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold text-primary mb-1">Tra cứu trạng thái</h2>
            <p class="text-muted mb-0">Tìm kiếm trạng thái hiện tại và lịch sử theo Serial Number.</p>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient text-white">
                    <h5 class="mb-0">Tra cứu theo trạng thái</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="filter-status" class="form-label fw-semibold">Trạng thái</label>
                        <select id="filter-status" class="form-select">
                            <option value="4">4 - Waiting approve replace BGA</option>
                            <option value="10">10 - Check in barking</option>
                            <option value="11">11 - Check out barking</option>
                            <option value="12">12 - VI after barking</option>
                            <option value="13">13 - Remove BGA, clean pad</option>
                            <option value="14">14 - Check VI BGA pad</option>
                            <option value="15">15 - Replace BGA</option>
                            <option value="16">16 - Xray</option>
                            <option value="17">17 - ICT, FT</option>
                            <option value="3">3 - Replaced BGA ok</option>
                        </select>
                    </div>
                    <div class="d-flex gap-2 mb-3">
                        <button id="load-status-btn" class="btn btn-outline-primary flex-grow-1">Tải dữ liệu</button>
                        <button id="clear-result-btn" class="btn btn-outline-secondary">Xóa</button>
                    </div>
                    <div id="status-feedback" class="alert d-none" role="alert"></div>
                    <div id="status-result" class="table-responsive" style="max-height: 420px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/assets/Areas/BGA/js/replace-bga.js"></script>
}
